<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>STATE MACHINE</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <!-- <link rel="stylesheet" href="style.css" /> -->
    <link rel="stylesheet" href="shared.css" />
    <style>
      :root {
         --gc-outer: 840px; /* Containergröße Richtwert */
      }

      @media (max-width: 900px) {
        :root {
        --gc-outer: 704px; /* 704 / 8 = 88 */
        }
      }

      @media (max-width: 600px) {
        :root {
        --gc-outer: 448px; /* 448 / 8 = 56 */
        }
      }  

      body {
        margin: 0;
        overflow: hidden;
        font-family: "Courier New", Courier, monospace;
        color: #fff;
        background: radial-gradient(circle, #ffffff, #000);
        background-attachment: fixed;
      }

      a {
        text-decoration: none;
        display: block;
      }

      img {
        -webkit-user-drag: none;
      }

      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: #000;
      }

      ::-webkit-scrollbar-thumb {
        background: #000000;
        border: 1px solid #fff;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #ffffff;
      }

      .v-pillar-group {
        position: absolute;
        top: 0;
        width: var(--gc-outer);
        height: 200vh;
        margin-left: 60px;
        display: flex;
        gap: calc(var(--gc-outer) / 7);
      }

      .h-pillar-group {
        position: absolute;
        display: flex;
        flex-direction: column;
        left: 0;
        width: 200vw;
        height: var(--gc-outer);
        gap: calc(var(--gc-outer) / 7);
      }

      .v-pillar {
        width: calc(var(--gc-outer) / 7);
        height: 100%;
        background: #000;
      }

      .h-pillar {
        height: calc(var(--gc-outer) / 7);
        width: 100%;
        background: #000;
      }

      #machine-container-wrapper {
        margin: 60px;
      }

      #machine-container {
        position: absolute;
        overflow: hidden; 
        width: calc(var(--gc-outer) / 14 * 12);
        height: calc(var(--gc-outer) / 14 * 12);
        min-width: calc(var(--gc-outer) / 14 * 12);
        min-height: calc(var(--gc-outer) /14 * 12);
        border: calc(var(--gc-outer) / 14) ridge #000000;
        justify-content: center;
        align-items: center;
       /* border-image: url(./assets/images/Textures/Concrete017_4K-JPG/Concrete017_4K-JPG_Color.jpg)
          1000 stretch; */
       user-select: none; /* standard */
       -webkit-user-select: none; /* Chrome/Safari */
       -moz-user-select: none; /* Firefox */
       -ms-user-select: none; /* IE/Edge */
       pointer-events: auto;  /* keep clicks working */
       -webkit-user-drag: none; /* disables image drag in WebKit browsers */
      }

      /* keeps buttons clickable */
      #machine-container button {
        user-select: auto;
      }

      #machine-content {
        width: 100%;
        height: 100%;
      }

      /* SCENES */
      .scene {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        background: #000;
        opacity: 0;
        pointer-events: none;
      }

      .scene.active {
        opacity: 1;
        pointer-events: auto;
      }

      /* makes sure every scene fills the machine window */
      #machine-content > div {
        width: 100%;
        height: 100%;
      }

      .trans-scene {
        background: black;
      }

      .trans-title {
        max-width: 100%;
      }

      .trans-img {
        max-width: 50%;
      }

      .hidden {
        display: none !important;
      }

      .btn {
        font-family: "Courier New", Courier, monospace;
        color: #fff;
        font-size: 12pt;
        background: #000;
        border: 1px solid #fff;
        width: 100%;
        cursor: pointer;
      }

      #final-btn:hover {
        font-family: "Courier New", Courier, monospace;
        color: #fff;
      }

      #final {
        position: absolute;
        top: 300px;
        width: 100%;
      }

      .btn:hover, .choice-btn:hover  {
        background: #fff;
        color: #000;
      }

      .btn.hidden {
        display: none;
      }

      /* STAGE 1 */

      .bg-area {
        position: absolute;
        width: 100%;
        height: 100%;
        background: url(./assets/images/S1_bg.jpg);
        background-size: cover;
        filter: contrast(120%);
      }

      #dialog-box {
        position: absolute;
        width: 100%;
        height: 100%;
        max-height: 100%;
        overflow-y: scroll;
        overflow-x: hidden;
        background: linear-gradient(to right, black 10%, rgba(0, 0, 0, 0) 50%);
      }

      #dialog-text {
        line-height: 1.45;
        white-space: pre-wrap;
      }

      #input-container {
        position: absolute;
      }

      #dialog-input {
        background: #ffffff;
        border: 1px solid #000000;
        color: #000000;
        font-size: 12pt;
        font-family: "Courier New", Courier, monospace;
        width: calc(var(--gc-outer) / 14 * 12);
      }

      #next-btn {
        width: 100%;
      }

      #input-submit {
        position: absolute;
        background: #000;
        border: 1px solid #fff;
        border-left: none;
        border-right: none;
        color: #fff;
        width: calc(var(--gc-outer) / 14 * 12);
        font-family: inherit;
        font-size: inherit;
      }

      #input-submit:hover {
        background: #fff;
        color: #000;
      }

      #choice-container {
        position: absolute;
        display: flex;
        flex-direction: column;
        width: 100%;
      }

      #choice-container.hidden {
        display: none;
      }

      .choice-btn {
        background: #000;
        color: white;
        border: 1px solid #fff;
        border-left: none;
        border-right: none;
        cursor: pointer;
        width: 100%;
        font-family: inherit;
        font-size: inherit;
      }

      /* STAGE 2 */

      #hymn-progress-container {
        width: 100%;
        height: 12px;       
        overflow: hidden;
      }

      #hymn-progress-bar {
        width: 0%;
        height: 100%;
        background: #fff;
        transition: width 0.1s linear;
      }

      #hymn-montage {
        position: absolute;
        top: 0;
        left: 0;
        inset: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 1;
      }
       
      #hymn-montage.shrunk {
        width: 180px;
        height: 180px;
        top: auto;
        left: auto;
        cursor: pointer;
        overflow: hidden;
      }

      #hymn-montage.active {
        background: #000;
        pointer-events: auto;
        z-index: 1;
      }

      #hymn-montage img {
        position: absolute;
        inset: 0;
        width: 110%;
        height: 110%;
        object-fit: cover;
        opacity: 0;
        transition: opacity 3s ease, transform 20s ease;
        transform: scale(1.3);
        filter:saturate(50%) contrast(200%);
      }

      #hymn-montage img.active {
        opacity: 1;
        transform: scale(1);
      }

      #hymn-montage img:nth-child(-n+4) {
        transform: scale(1);
        transition: none;
        width: 100%;
        height: 100%;
      }

      #hymn-montage img:nth-child(-n+4).active {
        transform: scale(1);
        transition: none;
        animation: fadeInHoldFadeOut 10.992s ease forwards;
      }

      @keyframes fadeInHoldFadeOut {
        0%   { opacity: 1; }
        50%  { opacity: 1; }
        75%  { opacity: 0; }
        100% { opacity: 0; }
      }

      /* STAGE 3 */

      #S3-scene {
        display: flex;
        width: 100%;
        height: 100%;
      }

      #image-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
      }

      #image-grid .S3_img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: pointer;
        border: 1px solid #000;
        box-sizing: border-box;
      }

      #image-grid img.crossed {
        pointer-events: none;
        filter: invert();
      }

      #image-grid img:hover {
        border: 1px solid #fff;
      }

      .S3_center {
        overflow: hidden; 
        box-sizing: border-box;
      }

      #S3-center-text {
        line-height: 1.4;
      }

      #S3-proceed-btn {
        position: absolute;
        width: calc(var(--gc-outer) / 14 * 4);
      }

      #id-loading {
        position: absolute;
        inset: 0;
      }

      #id-card {
        scale: 0.5;
        transform-origin: top left;
      }

#loading-spinner {
  position: relative;
  width: 100%;      /* length of the track */
  height: 16px;      /* height of the track */
  margin: auto;
  overflow: hidden;
}

#loader-bar {
  position: absolute;
  width: 20%;       /* length of the moving block */
  height: 100%;
  background: #fff;  /* moving bar color */
  animation: slide 1s ease-in-out infinite alternate;
}

@keyframes slide {
  0% { left: 0; }
  100% { left: calc(100% - 20%); } /* ensures it stays inside the track */
}


      #final-scene .id-card-wrapper {
        display: none;
      }

      /* EFFECTS */

      .effects {
        position: absolute;
        inset: 0;
        pointer-events: none; /* CRITICAL: does not block buttons */
        z-index: 50;
      }

    /*  .effect-noise {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.2'/%3E%3C/svg%3E");
        animation: noiseMove 0.1s steps(2) infinite;
      }

      @keyframes noiseMove {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(-1px, -1px);
        }
      }  */

      .effect-scanlines {
        background: repeating-linear-gradient(
          to bottom,
          #ffffff08,
          #ffffff08 1px,
          transparent 2px,
          transparent 4px
        );
        opacity: 0.85;
      }

      .effect-vignette {
        background: radial-gradient(
          ellipse at center,
          transparent 55%,
          #00000085 100%
        );
      }

      /* DEBUG */

      #debug-menu {
        position: absolute;
        height: 60px;
        top: 0px;
        z-index: 999;
        border: 1px solid #fff;
        opacity: 0.1;
        display: flex;
        flex-direction: row;
      }

      #debug-menu:hover {
        opacity: 1;
      }

      #controls {
        top: 10px;
        right: 10px;
        background: #000000b3;
        font-size: 12px;
      }

      #stage-nav {
        display: flex;
      }

      #stage-nav.button {
        border: 1px solid #fff;
        background: #000;
        color: #fff;
      }

    </style>
  </head>

  <body>
    <div id="debug-menu">
      <div id="stage-nav">
        <button data-next="S1-trans-scene" class="stage btn">pre- <br> Stage 1</button>
        <button data-next="S1-scene" class="stage btn">Stage 1</button>
        <button data-next="S2-trans-scene" class="stage btn">pre- <br> Stage 2</button>
        <button data-next="S2-scene" class="stage btn">Stage 2</button>
        <button data-next="S3-trans-scene" class="stage btn"> pre- <br>Stage 3</button>
        <button class="stage btn" data-next="S3-scene">Stage 3</button>
        <button class="stage btn" data-next="final-scene">Final <br> Stage</button>
        <button class="stage btn" data-next="error-scene">ERROR</button>
      </div>

      <div id="controls">
        <label
          ><input type="checkbox" checked data-toggle="effect-noise" />
          Noise</label
        >
        <label
          ><input type="checkbox" checked data-toggle="effect-scanlines" />
          Scanlines</label
        >
        <label
          ><input type="checkbox" checked data-toggle="effect-vignette" />
          Vignette</label
        >
        <label
          >

          <label>
            <br>
  Volume
  <input
    type="range"
    id="debug-hymn-volume"
    min="0"
    max="1"
    step="0.05"
    value="0.5"
  />
</label>

<label>
  Speed
  <input
    type="range"
    id="debug-hymn-speed"
    min="0.5"
    max="50.0"
    step="0.1"
    value="1"
  />
</label>

      </div>
    </div>

    <div class="v-pillar-group">
      <div class="v-pillar"></div>
      <div class="v-pillar"></div>
      <div class="v-pillar"></div>
      <div class="v-pillar"></div>
    </div>
    <div class="h-pillar-group">
      <div class="h-pillar"></div>
      <div class="h-pillar"></div>
      <div class="h-pillar"></div>
      <div class="h-pillar"></div>
    </div>

    <div id="machine-container-wrapper">
      <div id="machine-container">
        <div class="effects effect-scanlines"></div>
        <div class="effects effect-vignette"></div>

        <div id="machine-content">
          <!-- INTRO SCENE-->
          <div id="intro-scene" class="scene active">
            <img class="trans-title" src="./assets/images/Intro.png" alt="">
            <button class="btn" data-next="rules-scene">START</button>
            The Department of Alien Processing deploys STATE MACHINE. <br>STATE MACHINE remains operable for matters regarding the permission to enter the State of Veritania.<br> You will be processed as a citizen of the State of Veritania. <br>
          </div>

          <!-- RULES SCENE-->
          <div id="rules-scene" class="scene hidden">
            1. The State of Veritania provides all of its citizens the means to which they are capable of attaining absolute freedom. 
It is thus imperative that any applying citizen is not afraid to attain and assume, with all its twists and consequences, said freedom. <br><br>
2. The State of Veritania operates on the utopian collective model of common spaces shared by all. It is thus imperative that any applying citizen is prepared to leave their home, their private place of comfort, behind, in order to live with and for the public. <br><br>
3. The State of Veritania demands the full dedication and accordance with all necessary bureaucratic procedures. It is thus imperative for any applying citizen to go through said procedure  and engage with it to the full extent of their capacities. <br><br>
If the applicant is in agreement with the above conditions they may start the procedure to enter into the territory of the State of Veritania.
<button class="btn" data-next="S1-trans-scene">START</button>
          </div>

          <!-- Pre-STAGE 1 -->
          <div id="S1-trans-scene" class="scene hidden">
            <img src="./assets/images/Trans-Stage1.png" alt="" class="trans-title">
            <button class="btn" data-next="S1-scene">START</button> 
            <div class="flex_row">
              <img src="./assets/images/S1_DIE KUNST HAT IMMER RECHT.jpg" alt="" class="trans-img">
            <span>
              Task: <br> <br>
            Read the questions carefully. One may only fail this test, so take your time.<br><br></span>
            </div>
          </div>

          <!-- STAGE 1 -->
          <div id="S1-scene" class="scene hidden">
            <div class="bg-area">
              <div id="dialog-box">
                <div id="dialog-text"></div>

                <div id="choice-container" class="hidden"></div>

                <div id="input-container" class="hidden">
                  <input id="dialog-input" type="text" autocomplete="off" maxlength="18"/><br>
                  <button id="input-submit" class="btn">OK</button>
                </div>

                <div id="dialog-controls">
                  <button id="next-btn" class="btn hidden">></button>
                  <button
                    id="dialog-done-btn"
                    class="btn hidden"
                    data-next="S2-trans-scene"
                  >
                    PROCEED
                  </button>
                </div>
                <div style="height: 180px;"></div>
              </div>
            </div>
          </div>

          <!-- Pre-STAGE 2-->
          <div id="S2-trans-scene" class="scene hidden">
            <img src="./assets/images/Trans-Stage2.png" alt="" class="trans-title">
            <button class="btn" data-next="S2-scene">START</button>
            <div class="flex_row">
            <img src="./assets/images/S2_Volksempfänger.jpg" alt="" class="trans-img">
            Task: <br> <br> 
            Listen to the Anthem of Veritania. You are not required to sing or learn it, but listen attentively. <br> Let the music wash over your soul and enter the darkest depths of your heart.
            <br>
</div>
          </div>

          <!-- STAGE 2 -->
          <div id="S2-scene" class="scene hidden">
            <div class="hymn-wrapper">
  Title:  百花斉放 <br><br>
  Lyrics: <br>
  恐れるな <br>
恐れるな <br>
汗を流せ、我が子らよ <br>
太陽のために戦え <br>
<!--
おそれるな <br>
おそれるな <br>
あせをながせ、わがこらよ <br>
たいようのためにたたかえ <br>-->
<div id="hymn-progress-container">
  <div id="hymn-progress-bar"></div>
</div>


              <div id="hymn-montage" class="hidden">
                <img src="assets/images/Stage_2/00A.jpg" />
                <img src="assets/images/Stage_2/00B.jpg" />
                <img src="assets/images/Stage_2/00C.jpg" />
                <img src="assets/images/Stage_2/00D.jpg" />
                <img src="assets/images/Stage_2/01.jpg" />
                <img src="assets/images/Stage_2/02.jpg" />
                <img src="assets/images/Stage_2/03.jpg" />
                <img src="assets/images/Stage_2/04.jpg" />
                <img src="assets/images/Stage_2/05.jpg" />
                <img src="assets/images/Stage_2/06.jpg" />
                <img src="assets/images/Stage_2/07.jpg" />
                <img src="assets/images/Stage_2/08.jpg" />
                <img src="assets/images/Stage_2/09.jpg" />
                <img src="assets/images/Stage_2/10.jpg" />
                <img src="assets/images/Stage_2/11.jpg" />
                <img src="assets/images/Stage_2/12.jpg" />
                <img src="assets/images/Stage_2/13.jpg" />
                <img src="assets/images/Stage_2/14.jpg" />
              </div>

              <button id="hymn-play-btn" class="btn">►</button>
              <button
                id="S2-proceed-btn"
                class="btn hidden"
                data-next="S3-trans-scene"
              >
                PROCEED
              </button>
              <audio id="hymn-audio" src="assets/audio/百花斉放.mp3"></audio>
            </div>
          </div>

          <!-- Pre-STAGE 3 -->
          <div id="S3-trans-scene" class="scene hidden">
            <img src="./assets/images/Trans-Stage3.png" alt="" class="trans-title">
            <button class="btn" data-next="S3-scene">START</button>
            <div class="flex_row"><img src="./assets/images/S3_Bekenne dich zum Volk.jpg" alt="" class="trans-img">
            Task: <br> <br>
            Choose the avatar that you desire to be reduced to. Choosing an identity requires the exclusion of all others.<br>
            </div>
          </div>

          <!-- STAGE 3 -->
          <section id="S3-scene" class="scene hidden">
            <div id="image-grid">
              <img
                src="./assets/images/Stage_3/S3_01A.jpg"
                data-id="img1"
                class="S3_img"
                data-title="01_MOE"
              />
              <img
                src="./assets/images/Stage_3/S3_02A.jpg"
                data-id="img2"
                class="S3_img"
                data-title="02_MAN"
              />
              <img
                src="./assets/images/Stage_3/S3_03A.jpg"
                data-id="img3"
                class="S3_img"
                data-title="03_ANON"
              />
              <img
                src="./assets/images/Stage_3/S3_04A.jpg"
                data-id="img4"
                class="S3_img"
                data-title="04_REVOLUTION"
              />
  <div id="S3-center">
  <span id="S3-center-text"></span>
  <button data-next="final-scene" id="S3-proceed-btn" class="btn hidden">
              PROCEED
            </button>
            </div>
 
              <img
                src="./assets/images/Stage_3/S3_06A.jpg"
                data-id="img6"
                class="S3_img"
                data-title="06_GAZE"
              />
              <img
                src="./assets/images/Stage_3/S3_07A.jpg"
                data-id="img7"
                class="S3_img"
                data-title="07_RETRO"
              />
              <img
                src="./assets/images/Stage_3/S3_08A.jpg"
                data-id="img8"
                class="S3_img"
                data-title="08_POLITICS"
              />
              <img
                src="./assets/images/Stage_3/S3_09A.jpg"
                data-id="img9"
                class="S3_img"
                data-title="09_日常"
              />
            </div>

          </section>

          <!-- FINAL STAGE -->
          <section id="final-scene" class="scene hidden">
            <div id="id-loading">
              <div id="loading-spinner">
  <div id="loader-bar"></div>
</div>

              <div class="loading-text">Processing Citizen ID... <br> This process can take a moment.</div>
            </div>

            <div class="id-card-wrapper">
               <div id="id-card">
            <div id="id-header">
              <img src="./assets/images/Sato-Flag.jpg" alt="" class="id-flag" />
              <span id="id-title"
                >ALIEN PROCESSING DEPARTMENT <br />
                STATE OF VERIATNIA
              </span>
              <div id="id-score">
                <span id="score-title"></span> <span id="score-value"></span>
              </div>
            </div>
            <div class="flex_row">
              <div id="id-image-frame">
                <div class="tilt-card" id="id-tilt-card">
                  <img
                    id="final-image"
                    class="tilt-img img-a"
                    src=""
                    alt="Standard image"
                  />
                  <img class="tilt-img img-b" src="" alt="Tilt image" />
                </div>
              </div>
              <div id="id-stats">
                <div>
                  <span id="id-name">@</span>
                </div>
                <div>
                  <span class="stat">CONDEMNED BY: </span><br /><span
                    id="stat-born"
                    class="stat_value"
                  ></span>
                </div>
                <div>
                  <span class="stat">DEFINED BY: </span><br /><span
                    id="stat-fled"
                    class="stat_value"
                  ></span>
                </div>
                <div>
                  <span class="stat">TIME OF CONDEMNATION: </span><br /><span
                    id="stat-date"
                    class="stat_value"
                  ></span>
                </div>
                <div>
                  <span class="stat">HEIGHT: </span><br /><span
                    id="stat-height"
                    class="stat_value"
                  ></span>
                </div>
              </div>
            </div>
          </div>
              </div> <div id="final" class="hidden">
              You may proceed entering State of Veritania. <br>
              Right outside the perimeter you will find yourself at a bus station. Take a bus to a nearest municipality, to initiate further settlement proceedings.<br>  
 <button id="final-btn" class="btn" onclick="window.location.href='./bus.html'"> BUS</button>
          </div>
            
            </div>
          </section>

          <section id="error-scene" class="scene hidden">
  <div class="center">
    PROCESSING FAILURE
    <button onclick="location.reload()" class="btn">TRY AGAIN</button>
  </div>
</section>


          
        </div>
      </div>

    <script src="script.js"></script>
  </body>
</html>
